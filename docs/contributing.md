# Contributing to Meow

Thank you for your interest in contributing to the Meow programming language! This guide covers everything you need to know to get started.

## Development Environment Setup

### Prerequisites

- **Go 1.26+** â€” required for `iter` package support
- **stringer** â€” for code generation of token type names

```bash
# Install stringer
go install golang.org/x/tools/cmd/stringer@latest
```

### Clone and Build

```bash
git clone https://github.com/135yshr/meow.git
cd meow
go build ./cmd/meow
```

### Run Tests

```bash
go test ./...
```

## Build and Run

```bash
# Build the compiler
go build ./cmd/meow

# Run a .nyan program
go run ./cmd/meow run examples/hello.nyan

# Show transpiled Go code
go run ./cmd/meow transpile examples/hello.nyan

# Run tests
go test ./...

# Run tests verbose
go test ./... -v

# Static analysis
go vet ./...

# Update golden files (required when changing compiler output)
go test ./compiler/ -update

# Regenerate stringer output (after changing token types)
go generate ./...
```

## Project Structure

```
meow/
â”œâ”€â”€ cmd/meow/               # CLI entry point
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ compiler/               # Pipeline orchestration + E2E tests
â”‚   â”œâ”€â”€ compiler.go         # Compile, Build, Run methods
â”‚   â””â”€â”€ compiler_test.go    # Golden file tests
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ token/              # Token types, keywords, positions
â”‚   â”‚   â”œâ”€â”€ token.go
â”‚   â”‚   â””â”€â”€ tokentype_string.go  # Generated by stringer
â”‚   â”œâ”€â”€ lexer/              # iter.Seq-based tokenizer
â”‚   â”‚   â”œâ”€â”€ lexer.go
â”‚   â”‚   â””â”€â”€ lexer_test.go
â”‚   â”œâ”€â”€ ast/                # AST node definitions
â”‚   â”‚   â”œâ”€â”€ ast.go          # Expr, Stmt, Pattern nodes
â”‚   â”‚   â”œâ”€â”€ types.go        # TypeExpr, Param, BasicType
â”‚   â”‚   â””â”€â”€ walk.go         # AST tree walker
â”‚   â”œâ”€â”€ parser/             # Pratt parser (iter.Pull)
â”‚   â”‚   â”œâ”€â”€ parser.go
â”‚   â”‚   â””â”€â”€ parser_test.go
â”‚   â”œâ”€â”€ checker/            # Type checker
â”‚   â”‚   â””â”€â”€ checker.go
â”‚   â”œâ”€â”€ types/              # Type system definitions
â”‚   â”‚   â””â”€â”€ types.go
â”‚   â”œâ”€â”€ codegen/            # AST â†’ Go source generation
â”‚   â”‚   â”œâ”€â”€ codegen.go
â”‚   â”‚   â””â”€â”€ codegen_test.go
â”‚   â”œâ”€â”€ formatter/          # Code formatter
â”‚   â”‚   â””â”€â”€ formatter.go
â”‚   â”œâ”€â”€ linter/             # Code linter
â”‚   â”‚   â””â”€â”€ linter.go
â”‚   â””â”€â”€ mutation/           # Mutation testing support
â”‚       â””â”€â”€ mutation.go
â”œâ”€â”€ runtime/
â”‚   â”œâ”€â”€ meowrt/             # Core runtime: Value, operators, builtins
â”‚   â”‚   â”œâ”€â”€ value.go        # Value interface, Int, Float, String, Bool, etc.
â”‚   â”‚   â”œâ”€â”€ operators.go    # Arithmetic, comparison, logical operators
â”‚   â”‚   â”œâ”€â”€ builtins.go     # nya, hiss, gag, len, to_int, etc.
â”‚   â”‚   â””â”€â”€ list.go         # lick, picky, curl, head, tail, append
â”‚   â”œâ”€â”€ file/               # File I/O (snoop, stalk)
â”‚   â”‚   â””â”€â”€ file.go
â”‚   â”œâ”€â”€ http/               # HTTP client (pounce, toss, knead, swat, prowl)
â”‚   â”‚   â””â”€â”€ http.go
â”‚   â”œâ”€â”€ testing/            # Test framework (judge, expect, refuse, run)
â”‚   â”‚   â””â”€â”€ testing.go
â”‚   â””â”€â”€ coverage/           # Statement coverage tracking
â”‚       â””â”€â”€ coverage.go
â”œâ”€â”€ examples/               # Sample .nyan programs
â”œâ”€â”€ testdata/               # Golden file tests (.nyan + .golden)
â””â”€â”€ docs/                   # Documentation
```

## Adding a New Keyword

1. **Add the token** in `pkg/token/token.go`:
   - Add a constant in the `const` block (between `keywordsStart` and `keywordsEnd`)
   - Add an entry in the `keywords` map

2. **Regenerate stringer output**:
   ```bash
   go generate ./...
   ```

3. **Update the lexer** if needed (usually no changes â€” keywords are handled by `LookupIdent`)

4. **Update the parser** in `pkg/parser/parser.go`:
   - Add a case in `parseStmt()` or `parsePrefix()` as appropriate
   - Implement the parsing function

5. **Add AST node** in `pkg/ast/ast.go` if needed

6. **Update codegen** in `pkg/codegen/codegen.go`:
   - Handle the new AST node in `genStmt()` or `genExpr()`

7. **Add tests**:
   - Parser tests
   - Golden file tests in `testdata/`
   - Example in `examples/`

8. **Update documentation**:
   - `docs/reference.md` â€” add to keywords table
   - `docs/spec.md` â€” add grammar and semantics
   - Other docs as appropriate

## Adding a New Built-in Function

1. **Implement the function** in `runtime/meowrt/builtins.go` (or `list.go` for list operations):
   - Signature: `func Name(args ...Value) Value`
   - Use `"Hiss! ... , nya~"` for error messages

2. **Register in codegen** â€” add a case in `pkg/codegen/codegen.go`:
   - In `genCall()`, map the Meow name to the Go function name
   - In `genTypedCall()` if needed for typed mode

3. **Add tests**:
   - Unit tests for the runtime function
   - Integration tests (golden files)

4. **Update documentation**:
   - `docs/stdlib.md` â€” add function documentation
   - `docs/reference.md` â€” add to built-in functions table

## Adding a New Standard Library Package

1. **Create the package** at `runtime/<name>/`:
   - All public functions have signature `func Name(args ...meowrt.Value) meowrt.Value`
   - Use `"Hiss! ... , nya~"` for errors

2. **Register in codegen** â€” add entry to the `stdPackages` map in `pkg/codegen/codegen.go`:
   ```go
   var stdPackages = map[string]string{
       "file":    "github.com/135yshr/meow/runtime/file",
       "http":    "github.com/135yshr/meow/runtime/http",
       "testing": "github.com/135yshr/meow/runtime/testing",
       "mypackage": "github.com/135yshr/meow/runtime/mypackage",  // new
   }
   ```

3. The existing `genMemberCall` handles routing automatically â€” no other codegen changes needed

4. Users will write:
   ```meow
   fetch "mypackage"
   mypackage.my_func("arg")
   ```

5. **Add tests**:
   - Unit tests in `runtime/<name>/<name>_test.go`
   - Integration test with `fetch`

6. **Update documentation**:
   - `docs/stdlib.md` â€” add package section
   - `docs/reference.md` â€” mention the package

## Adding a Lint Rule

1. **Implement the rule** in `pkg/linter/linter.go`

2. **Add tests** for the new rule

3. **Update documentation** â€” mention the rule in `docs/effective-meow.md`

## Testing Conventions

### Golden File Tests

Located in `testdata/` with `.nyan` input and `.golden` expected output:

```
testdata/
  hello.nyan        # Input program
  hello.golden      # Expected output
```

Run golden tests:
```bash
go test ./compiler/
```

Update golden files when output changes:
```bash
go test ./compiler/ -update
```

### Unit Tests

Standard Go `_test.go` files in each package. Follow Go testing conventions:

```go
func TestSomething(t *testing.T) {
    // ...
}
```

### HTTP Tests

Use `httptest.NewServer` for local testing (see `runtime/http/http_test.go`).

### Panic Tests

Use `defer func() { recover() }()` to test `Hiss!` error paths:

```go
func TestHissOnInvalidInput(t *testing.T) {
    defer func() {
        if r := recover(); r == nil {
            t.Error("expected panic")
        }
    }()
    SomeFunction(invalidInput)
}
```

## Commit Style

We use [gitmoji](https://gitmoji.dev/) prefixes in commit messages:

| Prefix | Usage |
|--------|-------|
| `âœ¨ feat:` | New feature |
| `ğŸ› fix:` | Bug fix |
| `â™»ï¸ refactor:` | Code refactoring |
| `ğŸ“ docs:` | Documentation |
| `âœ… test:` | Adding/updating tests |
| `ğŸ¨ style:` | Code style/formatting |
| `â¬†ï¸ chore:` | Dependencies/tooling |
| `ğŸš€ ci:` | CI/CD changes |
| `ğŸ”§ fix:` | Configuration changes |

Commit messages are in **English**.

Example:
```
âœ¨ feat: Add string interpolation support
```

## PR Process

1. Fork the repository
2. Create a feature branch: `git checkout -b feat/my-feature`
3. Make your changes with tests
4. Ensure all tests pass: `go test ./...`
5. Ensure code passes vet: `go vet ./...`
6. Commit with gitmoji prefix
7. Push and open a Pull Request

### PR Checklist

- [ ] Tests pass (`go test ./...`)
- [ ] No vet warnings (`go vet ./...`)
- [ ] Golden files updated if output changed (`go test ./compiler/ -update`)
- [ ] Stringer regenerated if tokens changed (`go generate ./...`)
- [ ] Documentation updated for new features
- [ ] Commit messages use gitmoji prefix

## Dependencies

Meow has **zero external dependencies** â€” standard library only. Please do not introduce third-party packages.
