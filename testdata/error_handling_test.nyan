# Error handling test (hiss, gag, is_furball, ~>)

meow test_gag_catches_error() {
  nyan result = gag(paw() { divide(10, 0) })
  judge(is_furball(result))
}

meow test_gag_returns_value() {
  nyan result = gag(paw() { divide(10, 2) })
  refuse(is_furball(result))
  expect(result, 5)
}

meow test_is_furball_on_normal_values() {
  refuse(is_furball(42))
  refuse(is_furball("hello"))
  refuse(is_furball(yarn))
  refuse(is_furball([1, 2, 3]))
}

meow test_error_recovery_with_literal() {
  nyan safe = divide(10, 0) ~> 0
  expect(safe, 0)
}

meow test_error_recovery_no_error() {
  nyan result = divide(10, 2) ~> 0
  expect(result, 5)
}

meow test_error_recovery_with_handler() {
  nyan result = divide(10, 0) ~> paw(err) { 42 }
  expect(result, 42)
}

meow test_error_recovery_handler_no_error() {
  nyan result = divide(10, 5) ~> paw(err) { 42 }
  expect(result, 2)
}

meow test_chained_error_recovery() {
  nyan a = risky_chain(-1) ~> 0
  nyan b = risky_chain(a) ~> -1
  expect(a, 0)
  expect(b, 0)
}

meow test_divide_by_one() {
  expect(divide(10, 1), 10)
  expect(divide(0, 1), 0)
  expect(divide(100, 1), 100)
}

meow test_risky_chain_zero() {
  expect(risky_chain(0), 0)
}

meow test_risky_chain_positive_values() {
  expect(risky_chain(5), 10)
  expect(risky_chain(1), 2)
  expect(risky_chain(3), 6)
  expect(risky_chain(10), 20)
}

meow test_divide_error_is_furball() {
  nyan result = gag(paw() { divide(10, 0) })
  judge(is_furball(result))
  nyan result2 = gag(paw() { divide(5, 0) })
  judge(is_furball(result2))
}

meow test_risky_chain_negative_is_furball() {
  nyan result = gag(paw() { risky_chain(-1) })
  judge(is_furball(result))
  nyan result2 = gag(paw() { risky_chain(-100) })
  judge(is_furball(result2))
}

meow test_divide_error_message() {
  nyan err = gag(paw() { divide(10, 0) })
  expect(to_string(err), "Hiss! division by zero")
}

meow test_risky_chain_error_message() {
  nyan err = gag(paw() { risky_chain(-1) })
  expect(to_string(err), "Hiss! negative input")
}
